<!DOCTYPE html>
<html lang="en"><head><title>Training GPT from Scratch</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="Training GPT from Scratch"/><meta property="og:description" content="Source: www.youtube.com/watch Used ClipNote to generate notes mainly for my reference Reproducing the GPT2 124 Million Parameter Model Today‚Äôs task is to reproduce the GPT2 124 ..."/><meta property="og:image" content="static/og-image.png"/> <meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../static/icon.png"/><meta name="description" content="Source: www.youtube.com/watch Used ClipNote to generate notes mainly for my reference Reproducing the GPT2 124 Million Parameter Model Today‚Äôs task is to reproduce the GPT2 124 ..."/><meta name="generator" content="Quartz"/><link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Large-Model-Systems/Training-GPT-from-Scratch"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="..">üìù Notes</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabindex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="explorer desktop-only"><button type="button" id="explorer" data-behavior="collapse" data-collapsed="collapsed" data-savestate="true" data-tree="[{&quot;path&quot;:&quot;Advance-Energy-Systems&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Biology&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Computer-Architecture&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Computer-Vision&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Cryptography&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;CUDA&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Data-Structures-and-Algos&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Economics&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Education&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Large-Model-Systems&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Linux-Kernel-Development&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Memory&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;MRI&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Political-Theory&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Psychology&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Religion&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Religion/Bible&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Religion/Bible/Genesis&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Screenplay-Writing&quot;,&quot;collapsed&quot;:true},{&quot;path&quot;:&quot;Verilog&quot;,&quot;collapsed&quot;:true}]"><h1>Explorer</h1><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-content"><ul class="overflow" id="explorer-ul"><li><div class="folder-outer open"><ul style="padding-left:0;" class="content" data-folderul><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Advance-Energy-Systems"><button class="folder-button"><span class="folder-title">Advance Energy Systems</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Advance-Energy-Systems"><li><a href="../Advance-Energy-Systems/control-rods" data-for="Advance-Energy-Systems/control-rods">control rods</a></li><li><a href="../Advance-Energy-Systems/Dyson-Spheres" data-for="Advance-Energy-Systems/Dyson-Spheres">Dyson Spheres</a></li><li><a href="../Advance-Energy-Systems/Fission-Reaction" data-for="Advance-Energy-Systems/Fission-Reaction">Fission Reaction</a></li><li><a href="../Advance-Energy-Systems/gaseous-diffusion" data-for="Advance-Energy-Systems/gaseous-diffusion">gaseous diffusion</a></li><li><a href="../Advance-Energy-Systems/moderator" data-for="Advance-Energy-Systems/moderator">moderator</a></li><li><a href="../Advance-Energy-Systems/Neutron-Scattering" data-for="Advance-Energy-Systems/Neutron-Scattering">Neutron Scattering</a></li><li><a href="../Advance-Energy-Systems/Nuclear-Power-Plants" data-for="Advance-Energy-Systems/Nuclear-Power-Plants">Nuclear Power Plants</a></li><li><a href="../Advance-Energy-Systems/Nuclear-Reactor" data-for="Advance-Energy-Systems/Nuclear-Reactor">Nuclear Reactor</a></li><li><a href="../Advance-Energy-Systems/The-Grid" data-for="Advance-Energy-Systems/The-Grid">The Grid</a></li><li><a href="../Advance-Energy-Systems/uranium-enrichment" data-for="Advance-Energy-Systems/uranium-enrichment">uranium enrichment</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Biology"><button class="folder-button"><span class="folder-title">Biology</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Biology"><li><a href="../Biology/The-Genetic-Code" data-for="Biology/The-Genetic-Code">The Genetic Code</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Computer-Architecture"><button class="folder-button"><span class="folder-title">Computer Architecture</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Computer-Architecture"><li><a href="../Computer-Architecture/AC" data-for="Computer-Architecture/AC">AC</a></li><li><a href="../Computer-Architecture/ARM-architecture" data-for="Computer-Architecture/ARM-architecture">ARM architecture</a></li><li><a href="../Computer-Architecture/CMOS" data-for="Computer-Architecture/CMOS">CMOS</a></li><li><a href="../Computer-Architecture/Compute-in-Memory-(CIM)" data-for="Computer-Architecture/Compute-in-Memory-(CIM)">Compute-in-Memory (CIM)</a></li><li><a href="../Computer-Architecture/Computer-Architecture" data-for="Computer-Architecture/Computer-Architecture">Computer Architecture</a></li><li><a href="../Computer-Architecture/inverter" data-for="Computer-Architecture/inverter">inverter</a></li><li><a href="../Computer-Architecture/NMOS" data-for="Computer-Architecture/NMOS">NMOS</a></li><li><a href="../Computer-Architecture/Parallel-Processors" data-for="Computer-Architecture/Parallel-Processors">Parallel Processors</a></li><li><a href="../Computer-Architecture/PMOS" data-for="Computer-Architecture/PMOS">PMOS</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Computer-Vision"><button class="folder-button"><span class="folder-title">Computer Vision</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Computer-Vision"><li><a href="../Computer-Vision/Slam" data-for="Computer-Vision/Slam">Slam</a></li></ul></div></li><li><div class="folder-outer "><ul style="padding-left:0;" class="content" data-folderul></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Cryptography"><button class="folder-button"><span class="folder-title">Cryptography</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Cryptography"><li><a href="../Cryptography/Cryptography" data-for="Cryptography/Cryptography">Cryptography</a></li><li><a href="../Cryptography/Mono-alphabetic-substition" data-for="Cryptography/Mono-alphabetic-substition">Mono-alphabetic substition</a></li><li><a href="../Cryptography/STARKs" data-for="Cryptography/STARKs">STARKs</a></li><li><a href="../Cryptography/The-Vigen√®re-(poly-alphabetic-shift)-cipher" data-for="Cryptography/The-Vigen√®re-(poly-alphabetic-shift)-cipher">The Vigen√®re (poly-alphabetic shift) cipher</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="CUDA"><button class="folder-button"><span class="folder-title">CUDA</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="CUDA"><li><a href="../CUDA/3-component-vector-that-represent-the-thread-index-within-a-block-1" data-for="CUDA/3-component-vector-that-represent-the-thread-index-within-a-block-1">3-component vector that represent the thread index within a block 1</a></li><li><a href="../CUDA/CUDA" data-for="CUDA/CUDA">CUDA</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Data-Structures-and-Algos"><button class="folder-button"><span class="folder-title">Data Structures and Algos</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Data-Structures-and-Algos"><li><a href="../Data-Structures-and-Algos/KD-Tree" data-for="Data-Structures-and-Algos/KD-Tree">KD Tree</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Economics"><button class="folder-button"><span class="folder-title">Economics</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Economics"><li><a href="../Economics/Wealth-of-Nations" data-for="Economics/Wealth-of-Nations">Wealth of Nations</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Education"><button class="folder-button"><span class="folder-title">Education</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Education"></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Large-Model-Systems"><button class="folder-button"><span class="folder-title">Large Model Systems</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Large-Model-Systems"><li><a href="../Large-Model-Systems/1-bit-LLMs" data-for="Large-Model-Systems/1-bit-LLMs">1 bit LLMs</a></li><li><a href="../Large-Model-Systems/Allreduce" data-for="Large-Model-Systems/Allreduce">Allreduce</a></li><li><a href="../Large-Model-Systems/CLIP" data-for="Large-Model-Systems/CLIP">CLIP</a></li><li><a href="../Large-Model-Systems/CUDA-API-of-GPT-2" data-for="Large-Model-Systems/CUDA-API-of-GPT-2">CUDA API of GPT 2</a></li><li><a href="../Large-Model-Systems/Deep-Dive-of-GPT-architecture" data-for="Large-Model-Systems/Deep-Dive-of-GPT-architecture">Deep Dive of GPT architecture</a></li><li><a href="../Large-Model-Systems/Gemini" data-for="Large-Model-Systems/Gemini">Gemini</a></li><li><a href="../Large-Model-Systems/How-a-Transformer-works-at-inference-vs-training-time" data-for="Large-Model-Systems/How-a-Transformer-works-at-inference-vs-training-time">How a Transformer works at inference vs training time</a></li><li><a href="../Large-Model-Systems/IEEE-754" data-for="Large-Model-Systems/IEEE-754">IEEE-754</a></li><li><a href="../Large-Model-Systems/Liger-Kernels" data-for="Large-Model-Systems/Liger-Kernels">Liger Kernels</a></li><li><a href="../Large-Model-Systems/LlaMa-from-scratch" data-for="Large-Model-Systems/LlaMa-from-scratch">LlaMa from scratch</a></li><li><a href="../Large-Model-Systems/LLaVA" data-for="Large-Model-Systems/LLaVA">LLaVA</a></li><li><a href="../Large-Model-Systems/MatMul-Free-Language-Modeling" data-for="Large-Model-Systems/MatMul-Free-Language-Modeling">MatMul-Free Language Modeling</a></li><li><a href="../Large-Model-Systems/ML-Interpretability" data-for="Large-Model-Systems/ML-Interpretability">ML Interpretability</a></li><li><a href="../Large-Model-Systems/Optical-Circuit-Switches" data-for="Large-Model-Systems/Optical-Circuit-Switches">Optical Circuit Switches</a></li><li><a href="../Large-Model-Systems/Positional-embeddings-matrix" data-for="Large-Model-Systems/Positional-embeddings-matrix">Positional embeddings matrix</a></li><li><a href="../Large-Model-Systems/Post-Training-Static-quantization" data-for="Large-Model-Systems/Post-Training-Static-quantization">Post-Training Static quantization</a></li><li><a href="../Large-Model-Systems/Quantization" data-for="Large-Model-Systems/Quantization">Quantization</a></li><li><a href="../Large-Model-Systems/queries-(Q),-keys-(K),-and-values-(V)" data-for="Large-Model-Systems/queries-(Q),-keys-(K),-and-values-(V)">queries (Q), keys (K), and values (V)</a></li><li><a href="../Large-Model-Systems/Silent-Data-Corruption-(SDC)" data-for="Large-Model-Systems/Silent-Data-Corruption-(SDC)">Silent Data Corruption (SDC)</a></li><li><a href="../Large-Model-Systems/Softmax" data-for="Large-Model-Systems/Softmax">Softmax</a></li><li><a href="../Large-Model-Systems/SparseCore" data-for="Large-Model-Systems/SparseCore">SparseCore</a></li><li><a href="../Large-Model-Systems/SSM-vs-Transformer" data-for="Large-Model-Systems/SSM-vs-Transformer">SSM vs Transformer</a></li><li><a href="../Large-Model-Systems/Token-embeddings-matrix" data-for="Large-Model-Systems/Token-embeddings-matrix">Token embeddings matrix</a></li><li><a href="../Large-Model-Systems/Tokenization" data-for="Large-Model-Systems/Tokenization">Tokenization</a></li><li><a href="../Large-Model-Systems/Torchserve" data-for="Large-Model-Systems/Torchserve">Torchserve</a></li><li><a href="../Large-Model-Systems/TPUv4" data-for="Large-Model-Systems/TPUv4">TPUv4</a></li><li><a href="../Large-Model-Systems/Training-GPT-from-Scratch" data-for="Large-Model-Systems/Training-GPT-from-Scratch">Training GPT from Scratch</a></li><li><a href="../Large-Model-Systems/Transformers" data-for="Large-Model-Systems/Transformers">Transformers</a></li><li><a href="../Large-Model-Systems/Vector-matrix-multiplication-(VMM)" data-for="Large-Model-Systems/Vector-matrix-multiplication-(VMM)">Vector-matrix multiplication (VMM)</a></li><li><a href="../Large-Model-Systems/VIdeo-understanding" data-for="Large-Model-Systems/VIdeo-understanding">VIdeo understanding</a></li><li><a href="../Large-Model-Systems/Vision-Transformer" data-for="Large-Model-Systems/Vision-Transformer">Vision Transformer</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Linux-Kernel-Development"><button class="folder-button"><span class="folder-title">Linux Kernel Development</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Linux-Kernel-Development"><li><a href="../Linux-Kernel-Development/linux_kernel_development" data-for="Linux-Kernel-Development/linux_kernel_development">linux_kernel_development</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Memory"><button class="folder-button"><span class="folder-title">Memory</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Memory"><li><a href="../Memory/Memory" data-for="Memory/Memory">Memory</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="MRI"><button class="folder-button"><span class="folder-title">MRI</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="MRI"></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Political-Theory"><button class="folder-button"><span class="folder-title">Political Theory</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Political-Theory"><li><a href="../Political-Theory/Political-Theory" data-for="Political-Theory/Political-Theory">Political Theory</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Psychology"><button class="folder-button"><span class="folder-title">Psychology</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Psychology"><li><a href="../Psychology/Developmental-Psychology" data-for="Psychology/Developmental-Psychology">Developmental Psychology</a></li><li><a href="../Psychology/Erickson" data-for="Psychology/Erickson">Erickson</a></li><li><a href="../Psychology/Piaget" data-for="Psychology/Piaget">Piaget</a></li><li><a href="../Psychology/Vygotsky" data-for="Psychology/Vygotsky">Vygotsky</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Religion"><button class="folder-button"><span class="folder-title">Religion</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Religion"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Religion/Bible"><button class="folder-button"><span class="folder-title">Bible</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Religion/Bible"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Religion/Bible/Genesis"><button class="folder-button"><span class="folder-title">Genesis</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Religion/Bible/Genesis"><li><a href="../Religion/Bible/Genesis/Genesis" data-for="Religion/Bible/Genesis/Genesis">Genesis</a></li><li><a href="../Religion/Bible/Genesis/Genesis-1-2" data-for="Religion/Bible/Genesis/Genesis-1-2">Genesis 1-2</a></li><li><a href="../Religion/Bible/Genesis/Genesis-3" data-for="Religion/Bible/Genesis/Genesis-3">Genesis 3</a></li><li><a href="../Religion/Bible/Genesis/Genesis-4-5" data-for="Religion/Bible/Genesis/Genesis-4-5">Genesis 4-5</a></li><li><a href="../Religion/Bible/Genesis/Genesis-6-9" data-for="Religion/Bible/Genesis/Genesis-6-9">Genesis 6-9</a></li><li><a href="../Religion/Bible/Genesis/Genesis-10-11" data-for="Religion/Bible/Genesis/Genesis-10-11">Genesis 10-11</a></li><li><a href="../Religion/Bible/Genesis/Genesis-12-25" data-for="Religion/Bible/Genesis/Genesis-12-25">Genesis 12-25</a></li><li><a href="../Religion/Bible/Genesis/Genesis-26-27" data-for="Religion/Bible/Genesis/Genesis-26-27">Genesis 26-27</a></li><li><a href="../Religion/Bible/Genesis/Genesis-28-36" data-for="Religion/Bible/Genesis/Genesis-28-36">Genesis 28-36</a></li><li><a href="../Religion/Bible/Genesis/Genesis-37-50" data-for="Religion/Bible/Genesis/Genesis-37-50">Genesis 37-50</a></li></ul></div></li><li><a href="../Religion/Bible/Bible" data-for="Religion/Bible/Bible">Bible</a></li></ul></div></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Screenplay-Writing"><button class="folder-button"><span class="folder-title">Screenplay Writing</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Screenplay-Writing"><li><a href="../Screenplay-Writing/Screenplay-Course" data-for="Screenplay-Writing/Screenplay-Course">Screenplay Course</a></li></ul></div></li><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div data-folderpath="Verilog"><button class="folder-button"><span class="folder-title">Verilog</span></button></div></div><div class="folder-outer "><ul style="padding-left:1.4rem;" class="content" data-folderul="Verilog"><li><a href="../Verilog/learning_verilog" data-for="Verilog/learning_verilog">learning_verilog</a></li></ul></div></li><li><a href="../2024-09-23" data-for="2024-09-23">2024-09-23</a></li><li><a href="../Links" data-for="Links">Links</a></li></ul></div></li><li id="explorer-end"></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../">Home</a><p> ‚ùØ </p></div><div class="breadcrumb-element"><a href="../Large-Model-Systems/">Large Model Systems</a><p> ‚ùØ </p></div><div class="breadcrumb-element"><a href>Training GPT from Scratch</a></div></nav><h1 class="article-title">Training GPT from Scratch</h1><p show-comma="true" class="content-meta"><span>Nov 05, 2025</span><span>7 min read</span></p></div></div><article class="popover-hint"><p>Source: <a href="https://www.youtube.com/watch?v=l8pRSuU81PU&amp;t=3399s" class="external">https://www.youtube.com/watch?v=l8pRSuU81PU&amp;t=3399s<svg class="external-icon" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></p>
<p>Used <a href="../ClipNote" class="internal" data-slug="ClipNote">ClipNote</a> to generate notes mainly for my reference</p>
<p>Reproducing the GPT2 124 Million Parameter Model</p>
<p>Today‚Äôs task is to reproduce the GPT2 124 million parameter model by understanding its architecture, loading its weights successfully, and generating coherent text with the model. The process involves converting the TensorFlow-based model to PyTorch, examining the model‚Äôs parameters like positional and token embeddings, and ultimately writing a custom GPT2 class to train and potentially surpass the existing model‚Äôs performance.</p>
<p>Understanding the Implementation of GPT2 in PyTorch</p>
<p>The encoder in GPT2, known as a decoder-only Transformer, and the cross-attention mechanism are absent in the model. The GPT2 architecture includes reshuffling of layer norms and the addition of an extra layer normalization. The implementation involves defining modules like token embeddings, hidden layers, layer norms, and a final classifier, along with specific details on MLP blocks, non-linearities, and attention operations.</p>
<p>Model Initialization and Generation Process in GPT-2</p>
<p>The provided text explains the process of initializing a GPT-2 model, including handling hyperparameters, creating the model‚Äôs state dictionary, and dealing with transposed weights. It also details the forward function for generating text sequences and the process of setting up and generating text using the model. Additionally, it discusses the differences in text generation results between the manually initialized GPT-2 model and the pre-trained model from Hugging Face.</p>
<p>Autodetecting and Utilizing Devices in PyTorch</p>
<p>The text explains how to autodetect and utilize available devices in PyTorch, such as GPUs or CPUs, for running models efficiently. It demonstrates the process of preparing and tokenizing data sets, and how to create batches for training in Transformers, including handling labels for loss calculation and optimization steps.</p>
<p>Understanding the AtomW Optimizer in PyTorch</p>
<p>The Atom Optimizer is an alternative to SGD, with AtomW being a bug fix variant. It utilizes hyperparameters and buffers like m and v, akin to momentum and RMS prop, for individual gradient elements to expedite optimization, particularly beneficial for language models. Implementing AtomW involves careful considerations, such as proper device management and ensuring tensors are appropriately moved for efficient training.</p>
<p>Optimization Strategies for GPT-2 Training</p>
<p>The text discusses the optimization strategy for training the GPT-2 model, focusing on weight tying to save parameters, proper initialization following GPT-2 guidelines, and speeding up training by utilizing lower precision formats like TF32 or FP16 for improved performance on GPUs.</p>
<p>Optimization Techniques for GPU Memory Bandwidth and Performance</p>
<p>GPUs benefit from reduced data representation bits for easier data movement and quicker access due to memory bandwidth constraints. Tensor cores in GPUs excel at matrix multiplications, particularly in deep learning tasks, but are often memory-bound. Utilizing tf32 and bf16 precisions internally in operations can significantly speed up computations, although the trade-off involves reduced precision and potential memory bottlenecks.</p>
<p>The Transition to BFloat16 and the Impact on Training Efficiency</p>
<p>The transition from FP16 to BF16 in training models offers a reduced range but simplifies operations by eliminating the need for gradient scalers. By using torch.AutoCast in PyTorch, only the forward pass and loss calculation are surrounded, maintaining precision. Implementing torch.compile further enhances speed by optimizing operations, reducing memory round trips, and significantly improving processing time, making it a valuable tool for neural network compilation.</p>
<p>GPU Memory Hierarchy and Flash Attention Optimization</p>
<p>The text discusses the memory hierarchy in GPUs, highlighting the role of high bandwidth memory (HBM) and the structure of streaming multiprocessors (SMs) for calculations. It also introduces Flash Attention optimization, a kernel fusion algorithm that significantly improves performance by efficiently utilizing memory hierarchy and avoiding excessive reads and writes to high bandwidth memory. This optimization demonstrates the importance of memory access patterns over floating-point operations and showcases the potential for further enhancements beyond what Torch Compile can provide.</p>
<p>Optimization Improvements and Hyperparameters in GPT Models</p>
<p>The text discusses optimizing a network by increasing computation through adding fake tokens, resulting in a 4% improvement in performance. It also delves into the importance of understanding and adjusting hyperparameters, such as learning rate scheduling, in models like GPT-2 and GPT-3 for enhanced training efficiency and resource utilization.</p>
<p>Optimizing Training Parameters for GPT-3 Implementation</p>
<p>The text discusses setting optimal learning rates for different model sizes, implementing a warm-up and decay strategy, skipping batch size increase complexities, utilizing data sampling without replacement, incorporating weight decay for regularization, and simulating large batch sizes through gradient accumulation in the context of implementing a GPT-3 model.</p>
<p>Understanding Gradient Accumulation</p>
<p>The text explains the concept of gradient accumulation in the context of optimizing neural networks. It discusses the need for normalizing loss in the gradient accumulation process to ensure consistent gradients. The narrative also delves into utilizing multiple GPUs for collaborative optimization using distributed data parallelism in PyTorch.</p>
<p>Understanding Distributed Data Parallel (DDP) in Multi-Process Execution</p>
<p>The text explains the intricacies of utilizing Distributed Data Parallel (DDP) in a multi-process setting, where eight copies of a process run in parallel with different ranks. It delves into adjusting calculations for multiple processes and ensuring proper synchronization. The discussion covers aspects like data loading, model creation, gradient synchronization, and handling loss calculations within the DDP framework.</p>
<p>Multi-GPU Training and Data Sets for Language Models</p>
<p>The text discusses implementing multi-GPU training for deep learning models, specifically focusing on averaging across ranks and optimizing for speed. It also delves into the datasets used by GPT-2 and GPT-3, detailing the sources like Reddit outbound links and Common Crawl. Furthermore, it introduces the Fine Web dataset for educational content and the process of loading and pre-processing data shards for training a language model.</p>
<p>Training progress and evaluation strategies</p>
<p>The text details a training process where the GPU‚Äôs capacity allows for a significant batch size, potentially leading to fast and effective training comparable to GPT-2. Additionally, the discussion covers the implementation of evaluation on the validation split and the introduction of H swag evaluation, a multiple-choice dataset for language models, offering early signals and smooth evaluation.</p>
<p>Implementing HSwag Evaluation in Training Script</p>
<p>The text discusses the implementation of HSwag evaluation in a training script by iterating through examples, predicting the option with the lowest loss, synchronizing statistics among processes, and evaluating the HSwag accuracy. The author showcases the progress made in HSwag accuracy, surpassing the performance of GPT2 124M model with only 10 billion tokens in training. Some considerations are shared regarding data distribution, potential influences from the training set, and data quality improvements affecting the accuracy achieved.</p>
<p>Overview of GPT2 and GPT3 Training</p>
<p>The text discusses the optimization process of training GPT2 and GPT3 models, highlighting the improvements achieved in training efficiency and potential adjustments in hyperparameters for better performance. It also mentions the importance of data loader optimization, the possibility of achieving faster training with a higher learning rate, and the comparison between PyTorch and a faster Cuda implementation, LM.C, for training GPT models.</p>
<h2 id="key-points-covered">Key Points Covered<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#key-points-covered" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<ol>
<li>
<p>Reproducing the GPT2 124 Million Parameter Model</p>
</li>
<li>
<p>Understanding the Implementation of GPT2 in PyTorch</p>
</li>
<li>
<p>Model Initialization and Generation Process in GPT-2</p>
</li>
<li>
<p>Autodetecting and Utilizing Devices in PyTorch</p>
</li>
<li>
<p>Understanding the AtomW Optimizer in PyTorch</p>
</li>
<li>
<p>Optimization Strategies for GPT-2 Training</p>
</li>
<li>
<p>Optimization Techniques for GPU Memory Bandwidth and Performance</p>
</li>
<li>
<p>The Transition to BFloat16 and the Impact on Training Efficiency</p>
</li>
<li>
<p>GPU Memory Hierarchy and Flash Attention Optimization</p>
</li>
<li>
<p>Optimization Improvements and Hyperparameters in GPT Models</p>
</li>
<li>
<p>Optimizing Training Parameters for GPT-3 Implementation</p>
</li>
<li>
<p>Understanding Gradient Accumulation</p>
</li>
<li>
<p>Understanding Distributed Data Parallel (DDP) in Multi-Process Execution</p>
</li>
<li>
<p>Multi-GPU Training and Data Sets for Language Models</p>
</li>
<li>
<p>Training progress and evaluation strategies</p>
</li>
<li>
<p>Implementing HSwag Evaluation in Training Script</p>
</li>
<li>
<p>Overview of GPT2 and GPT3 Training</p>
</li>
</ol></article></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div></div><footer class><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.2.3</a> ¬© 2025</p><ul><li><a href="https://github.com/viraatdas/notes">GitHub</a></li></ul></footer></div></body><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script type="module">
          let mermaidImport = undefined
          document.addEventListener('nav', async () => {
            if (document.querySelector("code.mermaid")) {
              mermaidImport ||= await import('https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs')
              const mermaid = mermaidImport.default
              const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
              mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                theme: darkMode ? 'dark' : 'default'
              })

              await mermaid.run({
                querySelector: '.mermaid'
              })
            }
          });
          </script><script src="../postscript.js" type="module"></script></html>